# Table: azuread_directory_audit_report

Retrieve the list of audit logs generated by Azure Active Directory. This includes audit logs generated by various services within Azure AD, including user, app, device and group Management, privileged identity management (PIM), access reviews, terms of use, identity protection, password management (self-service and admin password resets), and self- service group management, and so on.

## Examples

### Basic info

```sql
select
  activity_display_name,
  activity_date_time,
  category,
  operation_type,
  initiated_by -> 'user' ->> 'userPrincipalName' as initiated_user,
  result
from
  azuread_directory_audit_report;
```

### List all activities related to policy

```sql
select
  activity_display_name,
  activity_date_time,
  category,
  operation_type,
  initiated_by -> 'user' ->> 'userPrincipalName' as initiated_user,
  result
from
  azuread_directory_audit_report
where
  category = 'Policy';
```

### List all activities initiated by a specific user

```sql
select
  activity_display_name,
  activity_date_time,
  category,
  operation_type,
  initiated_by -> 'user' ->> 'userPrincipalName' as initiated_user,
  result
from
  azuread_directory_audit_report
where
  filter = 'initiatedBy/user/userPrincipalName eq ''test@org.onmicrosoft.com''';
```

### List activities related to user creation in last 7 days

```sql
select
  activity_date_time,
  category,
  operation_type,
  initiated_by -> 'user' ->> 'userPrincipalName' as initiated_user,
  t ->> 'userPrincipalName' as new_user_name
from
  azuread_directory_audit_report,
  jsonb_array_elements(target_resources) as t
where
  activity_display_name = 'Add user'
  and activity_date_time >= (current_date - interval '7 days')
order by activity_date_time;
```

### List users who have reset their passwords in last 7 days

```sql
select
  activity_date_time,
  category,
  operation_type,
  initiated_by -> 'user' ->> 'userPrincipalName' as initiated_user,
  t ->> 'userPrincipalName' as target_user
from
  azuread_directory_audit_report,
  jsonb_array_elements(target_resources) as t
where
  t ->> 'displayName' = 'Microsoft password reset service'
  and activity_date_time >= (current_date - interval '7 days')
order by activity_date_time;
```
